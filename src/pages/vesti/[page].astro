---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import NewsCard from '../../components/news/NewsCard.astro';
import Pagination from '../../components/news/Pagination.astro';
import { slugify } from '../../utils/slugify';
import { getExcerpt } from '../../utils/excerpt';

export const getStaticPaths = (async ({ paginate }) => {
  const allNews = await getCollection('vesti');
  const sortedNews = allNews.sort((a, b) => {
    const dateA = a.data.date?.getTime() ?? 0;
    const dateB = b.data.date?.getTime() ?? 0;
    return dateB - dateA;
  });

  return paginate(sortedNews, { pageSize: 10 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<BaseLayout title={`Vesti - Strana ${page.currentPage}`}>
  <Header />

  <main class="container mx-auto px-4 py-8 flex-grow">
    <h1 class="text-3xl sm:text-4xl font-bold text-center mb-8 text-kk-text-primary">Vesti</h1>

    <div class="max-w-3xl mx-auto mb-8 bg-kk-surface/50 border-l-4 border-kk-accent p-6 rounded">
      <p class="text-slate-200 leading-relaxed text-base sm:text-lg">
        Pratite najnovije vesti, dešavanja i rezultate košarkaškog kluba "Karađorđevo".
        Ovde ćete pronaći izveštaje sa utakmica, turnira, treninga i svih važnih događaja iz života našeg kluba.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {page.data.map((news) => {
        // Extract ID from filename (vest_XXX.json -> XXX)
        const id = news.id.replace('vest_', '').replace('.json', '');
        return (
          <NewsCard
            title={news.data.title}
            date={news.data.date}
            excerpt={getExcerpt(news.data.content)}
            id={id}
            currentPage={page.currentPage}
          />
        );
      })}
    </div>

    <Pagination
      currentPage={page.currentPage}
      totalPages={page.lastPage}
      baseUrl="/vesti"
    />
  </main>

  <Footer />
</BaseLayout>
