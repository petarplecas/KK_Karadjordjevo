---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import NewsCard from '../../components/news/NewsCard.astro';
import { slugify } from '../../utils/slugify';
import { getExcerpt } from '../../utils/excerpt';

// Get all tournaments and sort by date (newest first)
const allTournaments = await getCollection('turniri');
const sortedTournaments = allTournaments.sort((a, b) => {
  if (!a.data.date || !b.data.date) return 0;
  return b.data.date.getTime() - a.data.date.getTime();
});
---

<BaseLayout title="Turniri">
  <Header />

  <main class="container mx-auto px-4 py-8 flex-grow">
    <h1 class="text-3xl sm:text-4xl font-bold text-center mb-8 text-kk-text-primary">
      Memorijalni turnir "Nikola i Branka"
    </h1>

    <div class="max-w-3xl mx-auto mb-8 bg-kk-surface/50 border-l-4 border-kk-accent p-6 rounded">
      <p class="text-slate-200 leading-relaxed text-base sm:text-lg">
        U znak sećanja na tragično nastradale košarkaša i košarkašicu Nikolu Radovića i Branku Sušu,
        košarkaški klub "Karađorđevo" 2007. godine ustanovio je memorijalni turnir koji nosi njihovo ime.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {sortedTournaments.map((tournament) => (
        <NewsCard
          title={tournament.data.title}
          date={tournament.data.date || new Date()}
          excerpt={getExcerpt(tournament.data.content)}
          id={slugify(tournament.data.title)}
          baseUrl="/turniri"
        />
      ))}
    </div>
  </main>

  <Footer />
</BaseLayout>
