---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import GalleryTimeline from '../../components/gallery/GalleryTimeline.astro';
import { buildGalleryData } from '../../utils/buildGalleryData';

// Build gallery data at build time
const galleryData = buildGalleryData();
---

<BaseLayout
  title="Galerija"
  description={`Galerija Košarkaškog kluba Karađorđevo - ${galleryData.totalImages} slika iz ${galleryData.yearRange}`}
>
  <Header />

  <main class="container mx-auto px-4 py-8 max-w-6xl flex-grow">
    <!-- Hero Section -->
    <article>
      <header class="mb-12 text-center">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-kk-text-primary mb-4">
          <span class="text-gradient">Galerija</span>
        </h1>
        <div class="h-1 w-24 bg-kk-accent rounded mx-auto mb-6"></div>

        <!-- Stats -->
        <div class="flex flex-wrap justify-center gap-6 sm:gap-8 mb-6">
          <div class="text-center">
            <div class="text-3xl sm:text-4xl font-bold text-kk-accent mb-1">
              {galleryData.totalImages}
            </div>
            <div class="text-sm sm:text-base text-kk-text-secondary">
              Slika
            </div>
          </div>

          <div class="text-center">
            <div class="text-3xl sm:text-4xl font-bold text-kk-accent-blue mb-1">
              {galleryData.totalEvents}
            </div>
            <div class="text-sm sm:text-base text-kk-text-secondary">
              Događaja
            </div>
          </div>

          <div class="text-center">
            <div class="text-3xl sm:text-4xl font-bold text-kk-accent mb-1">
              {galleryData.yearRange}
            </div>
            <div class="text-sm sm:text-base text-kk-text-secondary">
              Godine
            </div>
          </div>
        </div>

        <p class="text-kk-text-secondary text-base sm:text-lg max-w-3xl mx-auto">
          Hronološki pregled fotografija iz istorije našeg kluba - od osnivanja do danas.
          Kliknite na bilo koji događaj da vidite sve slike.
        </p>
      </header>

      <!-- Gallery Timeline -->
      <GalleryTimeline periods={galleryData.periods} />
    </article>
  </main>

  <Footer />
</BaseLayout>

<style>
  .text-gradient {
    background: linear-gradient(135deg, #f59e0b 0%, #3b82f6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
</style>

<script>
  function scrollToTarget() {
    // Check if there's a hash in the URL (e.g., #year-2015)
    const hash = window.location.hash;

    if (hash) {
      // Scroll to the hash target (year section)
      requestAnimationFrame(() => {
        const element = document.querySelector(hash);
        if (element) {
          element.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    } else {
      // Otherwise, restore saved scroll position
      const savedPosition = sessionStorage.getItem('galleryScrollPosition');
      if (savedPosition) {
        requestAnimationFrame(() => {
          window.scrollTo({
            top: parseInt(savedPosition, 10),
            behavior: 'instant'
          });
          // Clear the saved position after restoring
          sessionStorage.removeItem('galleryScrollPosition');
        });
      }
    }
  }

  // Scroll to target on page load
  scrollToTarget();

  // Also handle after Astro view transitions
  document.addEventListener('astro:page-load', () => {
    scrollToTarget();
  });
</script>
